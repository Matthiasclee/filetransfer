#!/usr/bin/env ruby
require "filetransfer"
require "socket"

originalpath = ARGV[0] || `zenity --file-selection`.chomp

path = originalpath.gsub(" ", "`")
name = originalpath.split("/").last.gsub(" ", "_")

recipient = ARGV[1] || `zenity --text='Recipient' --entry`.chomp

server = TCPSocket.new("127.0.0.1", 8021)
server.puts "FTSUBMIT #{name} #{path}"
fileid = server.gets

file_size = '%.2f' % (File.size(originalpath).to_f / 2**20)

server = TCPSocket.new(recipient, 8021)
server.puts "FTSEND #{name.gsub(" ", "_")} #{file_size}MB #{fileid}"

exit
